############https########################
openssl req -new -newkey rsa:2048 -sha256 -nodes \
 -out aginomoto_com.csr -keyout aginomoto_com.key \
 -subj "/C=CN/ST=shanghai/L=shanghai/O=whaley Inc./OU=Web Security/CN=*.aginomoto.com"

#移除密码
cp aginomoto_com.key aginomoto_com.key.org
openssl rsa -in aginomoto_com.key.org -out aginomoto_com.key
#crt证书
openssl x509 -req -days 3650 -in aginomoto_com.csr -signkey aginomoto_com.key -out aginomoto_com.crt

#aginomoto_com.crt aginomoto_com.key放到nginx的conf目录下

server {
    server_name test-wlslog.aginomoto.com;
    listen 443;
    ssl on;
    ssl_certificate aginomoto_com.crt;
    ssl_certificate_key aginomoto_com.key;

    set $forwardhost "";
    set_by_lua $forwardhost 'return ngx.req.get_headers()["forwardhost"]';
    location / {
        proxy_set_header Host $forwardhost;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:80;
    }
}

server {
    server_name test-wlsconfig.aginomoto.com;
    listen 443;
    ssl on;
    ssl_certificate aginomoto_com.crt;
    ssl_certificate_key aginomoto_com.key;

    location / {
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:80;
    }
}


curl -k -v https://test-wlslog.aginomoto.com/log/boikgpokn78sb95kbqei6cc98dc5mlsr?type=test

curl -k -v -H "Content-Type:application/json" -X POST --data '{"appId":"boikgpokn78sb95kbqei6cc98dc5mlsr"}'  https://test-wlsconfig.aginomoto.com/config

